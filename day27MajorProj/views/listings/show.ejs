<%- include('../layouts/header', {title: listing.title + ' listings'}) %>
<html>

<body>
  <% const {_id: id, title, description, image, price, location, country} = listing %>

  <h2 class="w-full py-3 mx-auto text-2xl text-center">Listings Details</h2>

  <div class="w-2/3 h-auto mx-auto my-4 border rounded cardd md:w-1/2">
    <div class="upper">
      <img class="rounded-t aspect-[18/9] w-full" src="<%= image %>" alt="" srcset="" />
    </div>
    <div class="px-3 py-4 bottom">
      <p class="text-xl font-semibold md:text-base"><%= title %></p>
      <p class="text-base md:text-sm"><%= description %></p>
      <p class="md:text-sm">â‚¹<%= price.toLocaleString('en-IN') %>/night</p>
      <p class="md:text-sm"><%= location %>, <%= country %></p>
    </div>

    <div class="flex gap-4 px-3 btns">
      <a class="h-0" href="/listings/<%= id %>/edit" method="get">
        <button class="px-8 py-2 text-lg text-white bg-red-700 border-0 rounded w-fit focus:outline-none hover:bg-red-600 md:text-sm">Edit</button>
      </a>

      <form class="" action="/listings/<%= id %>?_method=DELETE" method="post">
        <button class="px-8 py-2 text-lg text-white bg-black border-0 rounded w-fit focus:outline-none hover:bg-gray-900 md:text-sm">Delete</button>
      </form>
    </div>
  </div>


  <hr class="w-4/5 mx-auto">

  <form action="/listings/<%= id %>/review" method="POST" class="w-2/3 mx-auto my-6 md:w-1/2">
    <h3 class="text-xl md:text-lg">Leave a Review</h3>
    <label class="text-base md:text-sm" for="rating">Rating</label>
    <input class="w-1/2 in-range:border-green-500 out-of-range:border-red-500" type="range" name="review[rating]" id="rating" min="1" max="5" step="1" value="1" required>

    <label class="text-base md:text-sm" for="comment">Comment</label>
    <textarea class="p-2 placeholder:text-base md:placeholder:text-sm" name="review[comment]" id="comment" cols="30" rows="3" placeholder="Enter your comment here" required></textarea>

    <button class="px-8 py-2 my-3 text-lg text-white bg-black border-0 rounded focus:outline-none hover:bg-gray-900 md:text-sm" type="submit">Add</button>
  </form>


  <div class="w-2/3 mx-auto my-5 reviews md:w-1/2">
    <p class="text-xl md:text-lg">Reviews</p>
    <% for( let {_id: reviewId, comment, rating} of listing.reviews ) { %>
    <div class="flex justify-between px-4 my-2 oneReview">
      <p class="text-base md:text-sm"><%= comment %></p>
      <div class="flex gap-2 right">
        <p class="text-base md:text-sm"><%= rating %></p>

        <form action="/listings/<%= id %>/review/<%= reviewId %>?_method=DELETE" method="post" class="h-0">
          <button class="text-white bg-black border-0 px-2 py-0.5 focus:outline-none hover:bg-gray-900 rounded text-lg md:text-sm" type="submit"><i class="ri-delete-bin-5-line"></i>
          </button>
        </form>
      </div>
    </div>
    <% } %>

  </div>

  <%- include('../layouts/footer') %>
</body>

</html>